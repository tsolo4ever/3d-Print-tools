 {
  "$schema": "TH3D Configuration_adv.h Field Mapping v2.0 - Part 2",
  "description": "Configuration_adv.h: TMC Stepper Driver Settings",
  "lastUpdated": "2025-12-25",
  "version": "2.0.0",
  "sourceFile": "Configuration_adv.h",
  "part": "2 of 4 - TMC Drivers",
  
  "tmcDrivers": {
    "holdMultiplier": {
      "mapsFrom": ["HOLD_MULTIPLIER"],
      "type": "float",
      "required": false,
      "default": 0.5,
      "examples": [0.3, 0.5, 0.7],
      "th3dNotes": "Scales holding current from run current. 0.5 = 50% holding current."
    },
    "interpolate": {
      "mapsFrom": ["INTERPOLATE"],
      "type": "boolean",
      "required": false,
      "default": true,
      "th3dNotes": "Interpolate microsteps to 256 for smoother motion"
    }
  },

  "xAxis": {
    "current": {
      "mapsFrom": ["X_CURRENT"],
      "type": "integer",
      "required": false,
      "examples": [600, 700, 800],
      "th3dNotes": "RMS current in mA. Multiply by 1.414 for peak current."
    },
    "currentHome": {
      "mapsFrom": ["X_CURRENT_HOME"],
      "type": "integer",
      "required": false,
      "th3dNotes": "RMS current for sensorless homing"
    },
    "microsteps": {
      "mapsFrom": ["X_MICROSTEPS"],
      "type": "integer",
      "required": false,
      "default": 16,
      "examples": [8, 16, 32, 64, 128, 256],
      "th3dNotes": "Microstep resolution. Higher = smoother but slower."
    },
    "rsense": {
      "mapsFrom": ["X_RSENSE"],
      "type": "float",
      "required": false,
      "default": 0.11,
      "examples": [0.11, 0.15],
      "th3dNotes": "Sense resistor value (Ohms). Sovol SV06 uses 0.15"
    },
    "chainPos": {
      "mapsFrom": ["X_CHAIN_POS"],
      "type": "integer",
      "required": false,
      "default": -1,
      "examples": [-1, 0, 1, 2],
      "th3dNotes": "-1=Not chained, 0=Not chained, 1=MCU MOSI connected, 2=Next in chain"
    },
    "interpolateOverride": {
      "mapsFrom": ["X_INTERPOLATE"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "Override global INTERPOLATE setting for X axis"
    },
    "holdMultiplierOverride": {
      "mapsFrom": ["X_HOLD_MULTIPLIER"],
      "type": "float",
      "required": false,
      "th3dNotes": "Override global HOLD_MULTIPLIER for X axis"
    }
  },

  "yAxis": {
    "current": {
      "mapsFrom": ["Y_CURRENT"],
      "type": "integer",
      "required": false,
      "examples": [600, 700, 800, 1000],
      "th3dNotes": "Y current. CR-10 S5=800mA, S4=700mA, others=600mA"
    },
    "currentHome": {
      "mapsFrom": ["Y_CURRENT_HOME"],
      "type": "integer",
      "required": false
    },
    "microsteps": {
      "mapsFrom": ["Y_MICROSTEPS"],
      "type": "integer",
      "required": false,
      "default": 16
    },
    "rsense": {
      "mapsFrom": ["Y_RSENSE"],
      "type": "float",
      "required": false,
      "default": 0.11
    },
    "chainPos": {
      "mapsFrom": ["Y_CHAIN_POS"],
      "type": "integer",
      "required": false,
      "default": -1
    }
  },

  "zAxis": {
    "current": {
      "mapsFrom": ["Z_CURRENT"],
      "type": "integer",
      "required": false,
      "examples": [700, 1000],
      "th3dNotes": "Z current. Dual Z motors use 1000mA, single uses 700mA"
    },
    "currentHome": {
      "mapsFrom": ["Z_CURRENT_HOME"],
      "type": "integer",
      "required": false
    },
    "microsteps": {
      "mapsFrom": ["Z_MICROSTEPS"],
      "type": "integer",
      "required": false,
      "default": 16
    },
    "rsense": {
      "mapsFrom": ["Z_RSENSE"],
      "type": "float",
      "required": false,
      "default": 0.11
    },
    "chainPos": {
      "mapsFrom": ["Z_CHAIN_POS"],
      "type": "integer",
      "required": false,
      "default": -1
    }
  },

  "eAxis": {
    "current": {
      "mapsFrom": ["E0_CURRENT"],
      "type": "integer",
      "required": false,
      "examples": [500, 600],
      "th3dNotes": "E0 current. Pancake stepper=500mA, standard=600mA"
    },
    "microsteps": {
      "mapsFrom": ["E0_MICROSTEPS"],
      "type": "integer",
      "required": false,
      "default": 16
    },
    "rsense": {
      "mapsFrom": ["E0_RSENSE"],
      "type": "float",
      "required": false,
      "default": 0.11
    },
    "chainPos": {
      "mapsFrom": ["E0_CHAIN_POS"],
      "type": "integer",
      "required": false,
      "default": -1
    }
  },

  "chopperTiming": {
    "global": {
      "mapsFrom": ["CHOPPER_TIMING"],
      "type": "enum",
      "required": false,
      "examples": ["CHOPPER_DEFAULT_12V", "CHOPPER_DEFAULT_24V", "CHOPPER_DEFAULT_36V"],
      "th3dNotes": "Chopper timing for voltage. 12V or 24V printers."
    }
  },

  "monitoring": {
    "monitorDriverStatus": {
      "mapsFrom": ["MONITOR_DRIVER_STATUS"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "Monitor TMC drivers for overtemp and shorts"
    },
    "currentStepDown": {
      "mapsFrom": ["CURRENT_STEP_DOWN"],
      "type": "integer",
      "required": false,
      "conditionalOn": ["MONITOR_DRIVER_STATUS"],
      "default": 50,
      "examples": [50],
      "th3dNotes": "Reduce current by this amount (mA) on overtemp"
    },
    "reportCurrentChange": {
      "mapsFrom": ["REPORT_CURRENT_CHANGE"],
      "type": "boolean",
      "required": false,
      "conditionalOn": ["MONITOR_DRIVER_STATUS"],
      "th3dNotes": "Report when current is reduced due to overtemp"
    },
    "stopOnError": {
      "mapsFrom": ["STOP_ON_ERROR"],
      "type": "boolean",
      "required": false,
      "conditionalOn": ["MONITOR_DRIVER_STATUS"],
      "th3dNotes": "Stop print on driver error"
    }
  },

  "stealthChop": {
    "enabled": {
      "mapsFrom": ["HAS_STEALTHCHOP"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "TMC ultra-quiet stepping mode (vs spreadCycle)"
    },
    "xy": {
      "mapsFrom": ["STEALTHCHOP_XY"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "Enable StealthChop for XY. Disabled if XY_SPREADCYCLE set."
    },
    "z": {
      "mapsFrom": ["STEALTHCHOP_Z"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "Enable StealthChop for Z. Disabled if Z_SPREADCYCLE set."
    },
    "e": {
      "mapsFrom": ["STEALTHCHOP_E"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "Enable StealthChop for extruder. Set by E_STEALTHCHOP."
    }
  },

  "hybridThreshold": {
    "enabled": {
      "mapsFrom": ["HYBRID_THRESHOLD"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "Switch to spreadCycle above threshold speed. Requires StealthChop enabled."
    },
    "xThreshold": {
      "mapsFrom": ["X_HYBRID_THRESHOLD"],
      "type": "integer",
      "required": false,
      "conditionalOn": ["HYBRID_THRESHOLD"],
      "default": 100,
      "examples": [80, 100, 120],
      "th3dNotes": "X axis threshold speed (mm/s)"
    },
    "yThreshold": {
      "mapsFrom": ["Y_HYBRID_THRESHOLD"],
      "type": "integer",
      "required": false,
      "conditionalOn": ["HYBRID_THRESHOLD"],
      "default": 100,
      "th3dNotes": "Y axis threshold speed (mm/s)"
    },
    "zThreshold": {
      "mapsFrom": ["Z_HYBRID_THRESHOLD"],
      "type": "integer",
      "required": false,
      "conditionalOn": ["HYBRID_THRESHOLD"],
      "default": 3,
      "th3dNotes": "Z axis threshold speed (mm/s)"
    },
    "eThreshold": {
      "mapsFrom": ["E0_HYBRID_THRESHOLD"],
      "type": "integer",
      "required": false,
      "conditionalOn": ["HYBRID_THRESHOLD"],
      "default": 30,
      "th3dNotes": "E axis threshold speed (mm/s)"
    }
  },

  "sensorlessHoming": {
    "enabled": {
      "mapsFrom": ["SENSORLESS_HOMING"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "Use StallGuard for homing (no physical endstops)"
    },
    "xStallSensitivity": {
      "mapsFrom": ["X_STALL_SENSITIVITY"],
      "type": "integer",
      "required": false,
      "conditionalOn": ["SENSORLESS_HOMING", "X_AXIS_SENSORLESS_HOMING"],
      "examples": [75, 100, 130],
      "th3dNotes": "X StallGuard sensitivity. TMC2209: 0-255, TMC2130: -64 to 63. Set by X_SH_CALIBRATION."
    },
    "yStallSensitivity": {
      "mapsFrom": ["Y_STALL_SENSITIVITY"],
      "type": "integer",
      "required": false,
      "conditionalOn": ["SENSORLESS_HOMING", "Y_AXIS_SENSORLESS_HOMING"],
      "th3dNotes": "Y StallGuard sensitivity. Set by Y_SH_CALIBRATION."
    },
    "spiEndstops": {
      "mapsFrom": ["SPI_ENDSTOPS"],
      "type": "boolean",
      "required": false,
      "conditionalOn": ["SENSORLESS_HOMING"],
      "th3dNotes": "Poll driver via SPI instead of DIAG pin (TMC2130/TMC5160 only)"
    },
    "improveHomingReliability": {
      "mapsFrom": ["IMPROVE_HOMING_RELIABILITY"],
      "type": "boolean",
      "required": false,
      "conditionalOn": ["SENSORLESS_HOMING"],
      "th3dNotes": "Tune acceleration/jerk during homing for better reliability"
    }
  },

  "tmcDebug": {
    "enabled": {
      "mapsFrom": ["TMC_DEBUG"],
      "type": "boolean",
      "required": false,
      "th3dNotes": "Enable M122 debugging for TMC drivers"
    }
  },

  "slaveAddresses": {
    "description": "TMC2209 UART addresses when sharing serial port. Board-specific defaults.",
    "note": "These are set by board selection (#if logic). Only relevant for TMC2209 with shared UART.",
    "xAddress": {
      "mapsFrom": ["X_SLAVE_ADDRESS"],
      "type": "integer",
      "required": false,
      "examples": [0, 1, 2, 3],
      "th3dNotes": "X driver address. Set by MS1/MS2 jumpers. SKR boards: X=0, Ender6=1. Board-specific #if defaults."
    },
    "yAddress": {
      "mapsFrom": ["Y_SLAVE_ADDRESS"],
      "type": "integer",
      "required": false,
      "examples": [0, 1, 2, 3],
      "th3dNotes": "Y driver address. SKR boards: Y=2, Ender6=0. Board-specific #if defaults."
    },
    "zAddress": {
      "mapsFrom": ["Z_SLAVE_ADDRESS"],
      "type": "integer",
      "required": false,
      "examples": [0, 1, 2, 3],
      "th3dNotes": "Z driver address. Usually 1 or 2. Board-specific #if defaults."
    },
    "eAddress": {
      "mapsFrom": ["E0_SLAVE_ADDRESS"],
      "type": "integer",
      "required": false,
      "examples": [0, 3],
      "th3dNotes": "E0 driver address. Usually 3. Board-specific #if defaults."
    }
  },

  "microstepModes": {
    "modes": {
      "mapsFrom": ["MICROSTEP_MODES"],
      "type": "array",
      "arrayFormat": "{ X, Y, Z, E0, E1, E2 }",
      "required": false,
      "default": "{ 16, 16, 16, 16, 16, 16 }",
      "examples": ["{ 16, 16, 16, 16, 16, 16 }"],
      "th3dNotes": "Microstep mode for each axis. Options: 1,2,4,8,16,32,64,128,256"
    }
  }
}
