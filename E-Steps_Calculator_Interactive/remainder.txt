                </ul>
                <p><strong>Solutions:</strong></p>
                <ul>
                    <li>Use fresh, dry filament</li>
                    <li>Check extruder arm tension</li>
                    <li>Measure filament diameter with calipers</li>
                    <li>Repeat test 2-3 times and average</li>
                </ul>
            </div>

            <div class="step-card">
                <h3>‚ùå Settings Reset After Power Cycle</h3>
                <p><strong>Cause:</strong> M500 not sent or EEPROM disabled</p>
                <p><strong>Solution:</strong></p>
                <pre>M92 E###.##  ; Set value
M500         ; Save to EEPROM
M501         ; Reload from EEPROM  
M503         ; Verify it stuck</pre>
                <p>If still resetting, add to start G-code:</p>
                <pre>M92 E###.##  ; Force E-steps each print</pre>
            </div>

            <!-- Pro Tips -->
            <h2>üí° Pro Tips</h2>

            <div class="highlight-box">
                <h3>Tip 1: Slow is Accurate</h3>
                <p>Always extrude slowly during calibration (F100 or less). Fast extrusion can cause the motor to skip steps, giving inaccurate results.</p>
            </div>

            <div class="highlight-box">
                <h3>Tip 2: Use Fresh Filament</h3>
                <p>Old or wet filament can give inconsistent results. Use fresh, dry filament for calibration to ensure accuracy.</p>
            </div>

            <div class="highlight-box">
                <h3>Tip 3: Multiple Tests</h3>
                <p>Do the calibration test 2-3 times and average the results for best accuracy. Calculate E-steps for each test and use the average.</p>
            </div>

            <div class="highlight-box">
                <h3>Tip 4: Document Everything</h3>
                <p>Keep a log of E-steps values for each extruder configuration. Include date, extruder type, and any notes. This saves time if you need to revert or troubleshoot later.</p>
            </div>

            <div class="highlight-box">
                <h3>Tip 5: Don't Over-Adjust</h3>
                <p>If you're within ¬±2mm on a 100mm test (98-102mm actual), you're good enough. Don't chase perfection to 0.01 steps - it won't make a practical difference.</p>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>E-Steps Calibration Guide v2.0</strong></p>
            <p>Interactive Calculator Edition</p>
            <p style="margin-top: 15px;">Your Current Values:</p>
            <p><strong>Ender 3 Max:</strong> 425.0 steps/mm (Sprite Pro)</p>
            <p><strong>Ender 5 Plus:</strong> 424.09 steps/mm (Micro Swiss NG)</p>
            <p style="margin-top: 20px;"><em>Reference: TH3D Studio E-Step Calculator</em></p>
        </div>
    </div>

    <!-- Theme Toggle JavaScript -->
    <script src="../assets/js/navigation.js"></script>
    
    <!-- Calculator JavaScript -->
    <script>
        function calculateEsteps() {
            // Get input values
            const current = parseFloat(document.getElementById('currentEsteps').value);
            const requested = parseFloat(document.getElementById('requestedExtrusion').value);
            const actual = parseFloat(document.getElementById('actualExtrusion').value);
            
            // Validate inputs
            if (isNaN(current) || isNaN(requested) || isNaN(actual)) {
                alert('‚ö†Ô∏è Please fill in all fields with valid numbers!');
                return;
            }
            
            if (actual <= 0 || requested <= 0 || current <= 0) {
                alert('‚ö†Ô∏è All values must be greater than zero!');
                return;
            }
            
            // Calculate new E-steps
            const newEsteps = (current * requested) / actual;
            const change = newEsteps - current;
            const changePercent = (change / current) * 100;
            const errorPercent = ((requested - actual) / requested) * 100;
            
            // Determine status
            let status = '';
            let statusColor = '';
            
            if (Math.abs(errorPercent) <= 1) {
                status = '‚úÖ Excellent - Within 1% tolerance';
                statusColor = '#4caf50';
            } else if (Math.abs(errorPercent) <= 2) {
                status = '‚úÖ Good - Within 2% tolerance';
                statusColor = '#8bc34a';
            } else if (Math.abs(errorPercent) <= 5) {
                status = '‚ö†Ô∏è Acceptable - Should improve quality';
                statusColor = '#ff9800';
            } else if (Math.abs(errorPercent) <= 10) {
                status = '‚ö†Ô∏è Needs Adjustment - Significant error';
                statusColor = '#ff5722';
            } else {
                status = '‚ùå Critical - Check for mechanical issues';
                statusColor = '#f44336';
            }
            
            // Display results
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('newEsteps').textContent = newEsteps.toFixed(2) + ' steps/mm';
            
            const changeText = change >= 0 ? 
                `+${change.toFixed(2)} steps/mm (+${changePercent.toFixed(1)}%)` : 
                `${change.toFixed(2)} steps/mm (${changePercent.toFixed(1)}%)`;
            document.getElementById('changeAmount').textContent = changeText;
            
            document.getElementById('errorPercent').textContent = `${Math.abs(errorPercent).toFixed(2)}%`;
            
            const statusSpan = document.getElementById('statusMessage');
            statusSpan.textContent = status;
            statusSpan.style.color = statusColor;
            statusSpan.style.fontWeight = '700';
            
            // Generate G-code
            const gcode = `M92 E${newEsteps.toFixed(2)}  ; Set new E-steps
M500              ; Save to EEPROM
M503              ; Verify settings`;
            
            document.getElementById('gcodeCommands').textContent = gcode;
            
            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function copyGcode() {
            const gcode = document.getElementById('gcodeCommands').textContent;
            navigator.clipboard.writeText(gcode).then(() => {
                const btn = document.getElementById('copyBtn');
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }
        
        function loadPreset(printer) {
            let esteps = 0;
            
            switch(printer) {
                case 'ender3':
                    esteps = 425.0;
                    break;
                case 'ender5':
                    esteps = 424.09;
                    break;
                case 'bmg':
                    esteps = 415;
                    break;
                case 'orbiter':
                    esteps = 690;
                    break;
            }
            
            document.getElementById('currentEsteps').value = esteps;
            document.getElementById('requestedExtrusion').value = 100;
            document.getElementById('actualExtrusion').focus();
        }
        
        // Allow Enter key to calculate
        document.getElementById('actualExtrusion').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateEsteps();
            }
        });
    </script>
</body>
</html>